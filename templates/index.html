{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container">
  <h1>Delivery Tracker</h1>

  <!-- Dynamic drop grid driven by DB -->
  {% if num_drops %}
    <div class="drop-grid">
      {% for i in range(1, num_drops + 1) %}
        {# find the delivery record for this drop (or none) #}
        {% set d = deliveries | selectattr('drop_idx', 'equalto', i) | first %}

        <div class="drop-card">
          <h4>Drop {{ i }}</h4>

          {% if not d %}
            {# not started yet #}
            <form action="{{ url_for('start_delivery') }}" method="post">
              <input type="hidden" name="drop_index" value="{{ i }}">
              <button type="submit" name="action" value="start">Start</button>
            </form>

          {% elif not d.end_ts %}
            {# started but not stopped #}
            <form action="{{ url_for('start_delivery') }}" method="post">
              <input type="hidden" name="drop_index" value="{{ i }}">
              <button type="submit" name="action" value="stop">Stop</button>
            </form>

          {% else %}
            {# completed #}
            <p class="drop-elapsed">{{ d.elapsed }} seconds</p>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No drops configured yet. <a href="{{ url_for('configuration') }}">Click here to configure your shift.</a></p>
  {% endif %}

  <nav class="subnav">
    <a href="{{ url_for('configuration') }}">⚙️ Configure Shift</a>
  </nav>
</div>
{% endblock %}
